---
import { getCollection } from 'astro:content';
import BaseLayout from '../../layouts/BaseLayout.astro';
import Metadata from '../../components/Metadata.astro';

const posts = await getCollection('posts', ({ data }) => {
  return !data.draft;
});

// Sort by date, newest first
const sortedPosts = posts.sort((a, b) => {
  const dateA = a.data.date?.getTime() || 0;
  const dateB = b.data.date?.getTime() || 0;
  return dateB - dateA;
});
---

<BaseLayout title="Blog Posts">
  <h1>Blog Posts</h1>
  {sortedPosts.map((post) => (
    <div class="post">
      <h3>
        <a class="title" href={`/posts/${post.slug || post.id}/`}>
          {post.data.title}
        </a>
      </h3>
      <article>
        {post.data.summary && <p>{post.data.summary}</p>}
      </article>
      <Metadata date={post.data.date} tags={post.data.tags} />
    </div>
  ))}
</BaseLayout>
